
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>beginner-network-templating | The Colour of My Thoughts</title>
    <meta name="description"
        content="Develop and Deploy Network Templates Before Automating
Date: 2022-05-26
Subject: Network Templating
Version 1.0

Automation is the number one topic in networking today. Automation allows a team to lean left, moving simple troubleshooting to the NOC, it allows the team to do more with less, and it allows for repeatable deployments. A good place to start is to think about many of the day to day work that gets done, how much of this work is simply applying the same changes over and over. These tasks are a great place to start with templating.">
    <link rel="canonical" href="https://johnburns.io/post/beginner-network-templating/" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css">
    
    <link rel="stylesheet" href="https://johnburns.io/scss/style.min.aa7209164f013c6883aa54384ea45a46e582eacf9a17e9565badebd557dd1059.css">

    <meta property="og:url" content="https://johnburns.io/post/beginner-network-templating/">
  <meta property="og:site_name" content="The Colour of My Thoughts">
  <meta property="og:title" content="beginner-network-templating">
  <meta property="og:description" content="Develop and Deploy Network Templates Before Automating Date: 2022-05-26
Subject: Network Templating
Version 1.0
Automation is the number one topic in networking today. Automation allows a team to lean left, moving simple troubleshooting to the NOC, it allows the team to do more with less, and it allows for repeatable deployments. A good place to start is to think about many of the day to day work that gets done, how much of this work is simply applying the same changes over and over. These tasks are a great place to start with templating.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2022-05-26T13:00:00+00:00">
    <meta property="article:modified_time" content="2022-05-26T13:00:00+00:00">

    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="beginner-network-templating">
  <meta name="twitter:description" content="Develop and Deploy Network Templates Before Automating Date: 2022-05-26
Subject: Network Templating
Version 1.0
Automation is the number one topic in networking today. Automation allows a team to lean left, moving simple troubleshooting to the NOC, it allows the team to do more with less, and it allows for repeatable deployments. A good place to start is to think about many of the day to day work that gets done, how much of this work is simply applying the same changes over and over. These tasks are a great place to start with templating.">

    
    

</head><body><nav class="navbar is-light" role="navigation">
    <div class="container">
        <div class="navbar-brand">
            <a href="/" title="home" class="navbar-item">
                <span class="logo">
                    <h1>The Colour of My Thoughts</h1>
                </span>
            </a>

            
            <a id="theme-toggle" class="theme-toggle" href="#">
                <img src="https://johnburns.io/svg/sun.svg" alt="sun icon" class="theme-icon" />
            </a>

            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div class="navbar-menu">
            <div class="navbar-start">
                
                <a href="/about/" class="navbar-item">About</a>
                
                <a href="/resume.pdf" class="navbar-item">Resume</a>
                
                <a href="/contact/" class="navbar-item">Contact</a>
                
            </div>

        </div>
        <div class="search">
            <div id="fastSearch">
                <input id="searchInput" tabindex="0" placeholder="Search..">
                <ul id="searchResults">

                </ul>
            </div>
            <a id="search-btn" style="display: inline-block;" href="# ">
                <div class="icon-search"><svg class="search-svg" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></div>
            </a>
        </div>

        <script src="/js/fuse.min.js"></script> 
        <script src="/js/fastsearch.js"></script>

    </div>
</nav>

<script>
    
    document.addEventListener('DOMContentLoaded', function() {
        var burger = document.querySelector('.navbar-burger');
        burger.addEventListener('click', function() {
            burger.classList.toggle('is-active');
            document.querySelector('.navbar-menu').classList.toggle('is-active');
        });
    });

    
    function setTheme(theme) {
        let body = document.body;
        let themeIcon = document.querySelector(".theme-icon");
        if (theme === "dark") {
            body.classList.add("dark-mode");
            themeIcon.src = "https:\/\/johnburns.io\/svg/moon.svg";
            themeIcon.alt = "moon icon";
        } else {
            body.classList.remove("dark-mode");
            themeIcon.src = "https:\/\/johnburns.io\/svg/sun.svg";
            themeIcon.alt = "sun icon";
        }
        
        localStorage.setItem("theme", theme);
    }

    
    let theme = localStorage.getItem("theme") || "light";
    const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (isDarkMode) {
        
        setTheme('dark');

    } else {
        
        setTheme('light');
    }
    setTheme(theme);

    
    document.getElementById("theme-toggle").addEventListener("click", function() {
        if (theme === "light") {
            theme = "dark";
        } else {
            theme = "light";
        }
        setTheme(theme);
    });



</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css" integrity="sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib" crossorigin="anonymous">

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js" integrity="sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh" crossorigin="anonymous"></script>

    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>

    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LQNL2E5MEL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LQNL2E5MEL');
</script>
</header><main>
<div class="single-container">
    <div class="archive">
        <h1 class="title is-1">beginner-network-templating</h1>
        <div class="title subtitle heading is-6">
            <div class="author-info columns is-vcentered">
                <div class="column">
                    <div class="columns is-vcentered is-mobile">
                        
                        <div class="column">
                            <p>John Burns</p>
                            <p><time>May 26, 2022</time>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="small-categories-container">
                    
                </div>
            </div>
        </div>
        <div class="content article-content">
            <div class="toc-container">
                
    <div class="post-toc">
        
            <aside>
                <button id="tocButton" ><h4 id="contents" style="margin-left: 1vw;color:rgb(96, 134, 180);margin-bottom: 0;">CONTENTS</h4></button>
                <div id="hide"><nav id="TableOfContents">
  <ul>
    <li><a href="#develop-and-deploy-network-templates-before-automating">Develop and Deploy Network Templates Before Automating</a>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </aside>
        
    </div><script>
    
        let button = document.getElementById('tocButton');
        let hide = document.getElementById("hide");
        let contents=document.getElementById("contents");
        button.addEventListener("click", function() {
        if (hide.style.display!='block') {
            hide.style.display='block'
        } else {
            hide.style.display='none'
            contents.style.color='rgb(96, 134, 180)'
        }
        });
    




</script>
            </div>
            <h2 id="develop-and-deploy-network-templates-before-automating">Develop and Deploy Network Templates Before Automating</h2>
<p>Date: 2022-05-26<br>
Subject: Network Templating<br>
Version 1.0</p>
<!--start-summary-->
<p>Automation is the number one topic in networking today. Automation allows a team to lean left, moving simple troubleshooting to the NOC, it allows the team to do more with less, and it allows for repeatable deployments. A good place to start is to think about many of the day to day work that gets done, how much of this work is simply applying the same changes over and over. These tasks are a great place to start with templating.</p>
<p>I think an obvious task to start for automation is VPN deployments. This is a task that involved touching at least 2 routers and possibly 4 routers if redundant VPN&rsquo;s are the standard for your company. This usually also involves configuring an IGP or BGP instance or both on each router, as well as modifying multiple Access lists. It is also a task where small inconsistencies can lead to hours of troubleshooting.</p>



<div class="goat svg-container ">
  
    <svg
      xmlns="http://www.w3.org/2000/svg"
      font-family="Menlo,Lucida Console,monospace"
      
        viewBox="0 0 336 217"
      >
      <g transform='translate(8,16)'>
<path d='M 0,16 L 112,16' fill='none' stroke='currentColor'></path>
<path d='M 160,16 L 280,16' fill='none' stroke='currentColor'></path>
<path d='M 16,48 L 88,48' fill='none' stroke='currentColor'></path>
<path d='M 176,48 L 264,48' fill='none' stroke='currentColor'></path>
<path d='M 96,80 L 104,80' fill='none' stroke='currentColor'></path>
<path d='M 120,80 L 152,80' fill='none' stroke='currentColor'></path>
<path d='M 168,80 L 176,80' fill='none' stroke='currentColor'></path>
<path d='M 16,96 L 88,96' fill='none' stroke='currentColor'></path>
<path d='M 176,96 L 264,96' fill='none' stroke='currentColor'></path>
<path d='M 16,128 L 88,128' fill='none' stroke='currentColor'></path>
<path d='M 176,128 L 264,128' fill='none' stroke='currentColor'></path>
<path d='M 96,160 L 104,160' fill='none' stroke='currentColor'></path>
<path d='M 120,160 L 152,160' fill='none' stroke='currentColor'></path>
<path d='M 168,160 L 176,160' fill='none' stroke='currentColor'></path>
<path d='M 24,176 L 80,176' fill='none' stroke='currentColor'></path>
<path d='M 184,176 L 264,176' fill='none' stroke='currentColor'></path>
<path d='M 8,192 L 112,192' fill='none' stroke='currentColor'></path>
<path d='M 160,192 L 280,192' fill='none' stroke='currentColor'></path>
<path d='M 0,32 L 0,192' fill='none' stroke='currentColor'></path>
<path d='M 16,64 L 16,80' fill='none' stroke='currentColor'></path>
<path d='M 16,144 L 16,176' fill='none' stroke='currentColor'></path>
<path d='M 48,104 L 48,120' fill='none' stroke='currentColor'></path>
<path d='M 88,64 L 88,80' fill='none' stroke='currentColor'></path>
<path d='M 88,144 L 88,176' fill='none' stroke='currentColor'></path>
<path d='M 112,32 L 112,176' fill='none' stroke='currentColor'></path>
<path d='M 160,32 L 160,176' fill='none' stroke='currentColor'></path>
<path d='M 176,64 L 176,80' fill='none' stroke='currentColor'></path>
<path d='M 176,144 L 176,176' fill='none' stroke='currentColor'></path>
<path d='M 216,104 L 216,120' fill='none' stroke='currentColor'></path>
<path d='M 264,64 L 264,80' fill='none' stroke='currentColor'></path>
<path d='M 264,144 L 264,160' fill='none' stroke='currentColor'></path>
<path d='M 280,32 L 280,176' fill='none' stroke='currentColor'></path>
<path d='M 0,24 L 0,32' fill='none' stroke='currentColor'></path>
<path d='M 16,56 L 16,64' fill='none' stroke='currentColor'></path>
<path d='M 16,80 L 16,88' fill='none' stroke='currentColor'></path>
<path d='M 16,136 L 16,144' fill='none' stroke='currentColor'></path>
<path d='M 16,176 L 16,184' fill='none' stroke='currentColor'></path>
<path d='M 48,104 L 48,112' fill='none' stroke='currentColor'></path>
<path d='M 88,56 L 88,64' fill='none' stroke='currentColor'></path>
<path d='M 88,80 L 88,88' fill='none' stroke='currentColor'></path>
<path d='M 88,136 L 88,144' fill='none' stroke='currentColor'></path>
<path d='M 88,176 L 88,184' fill='none' stroke='currentColor'></path>
<path d='M 112,24 L 112,32' fill='none' stroke='currentColor'></path>
<path d='M 112,176 L 112,184' fill='none' stroke='currentColor'></path>
<path d='M 160,24 L 160,32' fill='none' stroke='currentColor'></path>
<path d='M 160,176 L 160,184' fill='none' stroke='currentColor'></path>
<path d='M 176,56 L 176,64' fill='none' stroke='currentColor'></path>
<path d='M 176,80 L 176,88' fill='none' stroke='currentColor'></path>
<path d='M 176,136 L 176,144' fill='none' stroke='currentColor'></path>
<path d='M 176,176 L 176,184' fill='none' stroke='currentColor'></path>
<path d='M 216,104 L 216,112' fill='none' stroke='currentColor'></path>
<path d='M 264,56 L 264,64' fill='none' stroke='currentColor'></path>
<path d='M 264,80 L 264,88' fill='none' stroke='currentColor'></path>
<path d='M 264,136 L 264,144' fill='none' stroke='currentColor'></path>
<path d='M 264,160 L 264,168' fill='none' stroke='currentColor'></path>
<path d='M 280,24 L 280,32' fill='none' stroke='currentColor'></path>
<path d='M 280,176 L 280,184' fill='none' stroke='currentColor'></path>
<text text-anchor='middle' x='24' y='68' fill='currentColor' style='font-size:1em'>H</text>
<text text-anchor='middle' x='24' y='148' fill='currentColor' style='font-size:1em'>H</text>
<text text-anchor='middle' x='32' y='68' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='32' y='148' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='40' y='68' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='40' y='148' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='48' y='36' fill='currentColor' style='font-size:1em'>H</text>
<text text-anchor='middle' x='48' y='68' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='48' y='84' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='48' y='148' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='48' y='164' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='56' y='36' fill='currentColor' style='font-size:1em'>Q</text>
<text text-anchor='middle' x='56' y='84' fill='currentColor' style='font-size:1em'>1</text>
<text text-anchor='middle' x='56' y='164' fill='currentColor' style='font-size:1em'>2</text>
<text text-anchor='middle' x='64' y='68' fill='currentColor' style='font-size:1em'>E</text>
<text text-anchor='middle' x='64' y='148' fill='currentColor' style='font-size:1em'>E</text>
<text text-anchor='middle' x='72' y='68' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='72' y='148' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='80' y='68' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='80' y='148' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='96' y='4' fill='currentColor' style='font-size:1em'>T</text>
<text text-anchor='middle' x='104' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='112' y='4' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='120' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='128' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='136' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='144' y='4' fill='currentColor' style='font-size:1em'>g</text>
<text text-anchor='middle' x='152' y='4' fill='currentColor' style='font-size:1em'>y</text>
<text text-anchor='middle' x='176' y='36' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='184' y='36' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='192' y='36' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='192' y='68' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='200' y='36' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='200' y='68' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='200' y='148' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='208' y='36' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='208' y='68' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='208' y='84' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='208' y='148' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='216' y='36' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='216' y='68' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='216' y='84' fill='currentColor' style='font-size:1em'>1</text>
<text text-anchor='middle' x='216' y='148' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='216' y='164' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='224' y='68' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='224' y='148' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='224' y='164' fill='currentColor' style='font-size:1em'>2</text>
<text text-anchor='middle' x='232' y='36' fill='currentColor' style='font-size:1em'>S</text>
<text text-anchor='middle' x='232' y='68' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='232' y='148' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='240' y='36' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='240' y='148' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='248' y='36' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='256' y='36' fill='currentColor' style='font-size:1em'>e</text>
</g>

    </svg>
  
</div>
<h5 id="whats-needed">What&rsquo;s Needed</h5>
<ul>
<li>Python 3.x
<ul>
<li>Jinja support</li>
<li>Yaml  support</li>
</ul>
</li>
<li>Yaml Answer File</li>
<li>Jinja Template for each router</li>
<li>python script to render</li>
</ul>
<ol>
<li>First we need to create a template for each router. I am only providing a single template here instead of four. Although this is a working correct template, configuring VPN&rsquo;s is beyond the scope of this tutorial. Anyone with a few years of experience should be able to build the missing files in a lab based on whats provided.</li>
</ol>
<ul>
<li>cisco.j2</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">!</span>Configure GRE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#960050;background-color:#1e0010">{{</span> <span style="color:#a6e22e">loopback_interface</span> }}
</span></span><span style="display:flex;"><span> ip address {{ loopback_address }}
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#960050;background-color:#1e0010">{{</span> <span style="color:#a6e22e">tunnel_interface</span>}}
</span></span><span style="display:flex;"><span>  no shutdown
</span></span><span style="display:flex;"><span>  ip address 10.<span style="color:#a6e22e">10</span>.<span style="color:#a6e22e">100</span>.<span style="color:#a6e22e">1</span> 255.<span style="color:#a6e22e">255</span>.<span style="color:#a6e22e">255</span>.<span style="color:#a6e22e">0</span>
</span></span><span style="display:flex;"><span>  tunnel source {{loopback_interface }}
</span></span><span style="display:flex;"><span>  tunnel destination {{ tunnel_destination }}
</span></span><span style="display:flex;"><span>  tunnel path<span style="color:#f92672">-</span>mtu<span style="color:#f92672">-</span>discovery
</span></span><span style="display:flex;"><span>  tunnel protection ipsec profile ikev2_TP
</span></span><span style="display:flex;"><span>  exit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">!</span>Configure Ike Policy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 keyring {{ ike_keyring_name }}
</span></span><span style="display:flex;"><span> peer {{ ike_keyring_peer }}
</span></span><span style="display:flex;"><span>  address {{ ike_keyring_address }}
</span></span><span style="display:flex;"><span>  pre<span style="color:#f92672">-</span>shared<span style="color:#f92672">-</span>key {{ ike_keyring_preshared_key }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 proposal {{proposal_name }}
</span></span><span style="display:flex;"><span> encryption {{ proposal_encryption }}
</span></span><span style="display:flex;"><span> integrity {{ proposal_integrity }}
</span></span><span style="display:flex;"><span> group {{ proposal_group }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 profile {{ profile_name }}
</span></span><span style="display:flex;"><span> match identity remote address {{ profile_remote_address }}
</span></span><span style="display:flex;"><span> authentication local {{ profile_authentication_local }}
</span></span><span style="display:flex;"><span> authentication remote {{ profile_authentication_remote }}
</span></span><span style="display:flex;"><span> keyring local {{ profile_keyring_local }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 policy {{ crypto_policy_name }}
</span></span><span style="display:flex;"><span> proposal {{ crypto_policy_proposal }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ip access<span style="color:#f92672">-</span>list extended {{ crypto_match_acl_name }}
</span></span><span style="display:flex;"><span> permit ip host {{ crypto_match_acl_local }} host {{ crypto_match_acl_remote }}
</span></span><span style="display:flex;"><span> permit ip host {{crypto_match_acl_remote }} host {{ crypto_match_acl_local }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ipsec transform<span style="color:#f92672">-</span>set {{ transformset_data }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">!</span> Define Crypto map and Ipsec
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto map {{ cryptomap_name }} ipsec<span style="color:#f92672">-</span>isakmp
</span></span><span style="display:flex;"><span> set peer {{ cryptomap_peer }}
</span></span><span style="display:flex;"><span> set security<span style="color:#f92672">-</span>association lifetime seconds 3600
</span></span><span style="display:flex;"><span> set transform<span style="color:#f92672">-</span>set {{ cryptomap_tset }}
</span></span><span style="display:flex;"><span> set pfs {{ cryptomap_group }}
</span></span><span style="display:flex;"><span> set ikev2<span style="color:#f92672">-</span>profile {{ cryptomap_profile }}
</span></span><span style="display:flex;"><span> match address {{ cryptomap_match }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#960050;background-color:#1e0010">{{</span> <span style="color:#a6e22e">interface_name</span> }}
</span></span><span style="display:flex;"><span> ip address 1.<span style="color:#a6e22e">1</span>.<span style="color:#a6e22e">1</span>.<span style="color:#a6e22e">1</span> 255.<span style="color:#a6e22e">255</span>.<span style="color:#a6e22e">255</span>.<span style="color:#a6e22e">224</span>
</span></span><span style="display:flex;"><span> negotiation auto
</span></span><span style="display:flex;"><span> {{ interface_crypto }}
</span></span></code></pre></div><ul>
<li>Yaml Answer file</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">loopback_interface</span>: <span style="color:#ae81ff">Loopback0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">loopback_address</span>: <span style="color:#e6db74">&#34;10.1.1.1 255.255.255.0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">tunnel_interface</span>: <span style="color:#ae81ff">Tunnel100</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">tunnel_destination</span>: <span style="color:#ae81ff">10.2.2.2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">ike_keyring_name</span>: <span style="color:#ae81ff">HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">ike_keyring_peer</span>: <span style="color:#ae81ff">HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">ike_keyring_address</span>: <span style="color:#ae81ff">2.2.2.2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">ike_keyring_preshared_key</span>: <span style="color:#ae81ff">cisco1234</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">proposal_name</span>: <span style="color:#ae81ff">Prop-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">proposal_encryption</span>: <span style="color:#ae81ff">aes-cbc-256</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">proposal_integrity</span>: <span style="color:#ae81ff">sha256</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">proposal_group</span>: <span style="color:#ae81ff">19</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">profile_name</span>: <span style="color:#ae81ff">PROFILE-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">profile_remote_address</span>: <span style="color:#e6db74">&#34;2.2.2.2 255.255.255.255&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">profile_authentication_local</span>: <span style="color:#ae81ff">pre-share</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">profile_authentication_remote</span>: <span style="color:#ae81ff">pre-share</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">profile_keyring_local</span>: <span style="color:#ae81ff">HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">crypto_policy_name</span>: <span style="color:#ae81ff">POL-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">crypto_policy_proposal</span>: <span style="color:#ae81ff">Prop-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">crypto_match_acl_name</span>: <span style="color:#ae81ff">VPNACL-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">crypto_match_acl_local</span>: <span style="color:#ae81ff">10.2.2.2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">crypto_match_acl_remote</span>: <span style="color:#ae81ff">10.1.1.1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">transformset_data</span>: <span style="color:#e6db74">&#34;TS-HQ esp-aes 256 esp-sha256-hmac&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cryptomap_name</span>: <span style="color:#e6db74">&#34;CMAP-HQ 10&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cryptomap_peer</span>: <span style="color:#ae81ff">2.2.2.2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cryptomap_tset</span>: <span style="color:#ae81ff">TS-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cryptomap_pfs</span>: <span style="color:#ae81ff">group19</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cryptomap_profile</span>: <span style="color:#ae81ff">PROFILE-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cryptomap_match</span>: <span style="color:#ae81ff">VPNACL-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">interface_name</span>: <span style="color:#ae81ff">GigabitEthernet0/0/0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">interface_crypto</span>: <span style="color:#e6db74">&#34;crypto map CMAP-HQ&#34;</span>
</span></span></code></pre></div><ul>
<li>script.py</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#Imports </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> yaml
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> jinja2 <span style="color:#f92672">import</span> Environment, FileSystemLoader
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Load yaml template into memory</span>
</span></span><span style="display:flex;"><span>config <span style="color:#f92672">=</span> yaml<span style="color:#f92672">.</span>load(open(<span style="color:#e6db74">&#39;./answer.yaml&#39;</span>,<span style="color:#e6db74">&#39;r&#39;</span>), Loader<span style="color:#f92672">=</span>yaml<span style="color:#f92672">.</span>FullLoader)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Load jinja template into memory</span>
</span></span><span style="display:flex;"><span>env <span style="color:#f92672">=</span> Environment(loader <span style="color:#f92672">=</span> FileSystemLoader(<span style="color:#e6db74">&#39;./&#39;</span>), trim_blocks<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, lstrip_blocks<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>template <span style="color:#f92672">=</span> env<span style="color:#f92672">.</span>get_template(<span style="color:#e6db74">&#39;cisco.j2&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Render template to file</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;cisco-out.txt&#34;</span>,<span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>  f<span style="color:#f92672">.</span>write(template<span style="color:#f92672">.</span>render(config))
</span></span></code></pre></div><ul>
<li>Output</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">!</span>Configure GRE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Loopback0</span>
</span></span><span style="display:flex;"><span> ip address 10.<span style="color:#a6e22e">1</span>.<span style="color:#a6e22e">1</span>.<span style="color:#a6e22e">1</span> 255.<span style="color:#a6e22e">255</span>.<span style="color:#a6e22e">255</span>.<span style="color:#a6e22e">0</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Tunnel100</span>
</span></span><span style="display:flex;"><span>  no shutdown
</span></span><span style="display:flex;"><span>  ip address 10.<span style="color:#a6e22e">10</span>.<span style="color:#a6e22e">100</span>.<span style="color:#a6e22e">1</span> 255.<span style="color:#a6e22e">255</span>.<span style="color:#a6e22e">255</span>.<span style="color:#a6e22e">0</span>
</span></span><span style="display:flex;"><span>  tunnel source Loopback0
</span></span><span style="display:flex;"><span>  tunnel destination 10.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">2</span>
</span></span><span style="display:flex;"><span>  tunnel path<span style="color:#f92672">-</span>mtu<span style="color:#f92672">-</span>discovery
</span></span><span style="display:flex;"><span>  tunnel protection ipsec profile ikev2_TP
</span></span><span style="display:flex;"><span>  exit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">!</span>Configure Ike Policy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 keyring HQ
</span></span><span style="display:flex;"><span> peer HQ
</span></span><span style="display:flex;"><span>  address 2.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">2</span>
</span></span><span style="display:flex;"><span>  pre<span style="color:#f92672">-</span>shared<span style="color:#f92672">-</span>key cisco1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 proposal Prop<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span> encryption aes<span style="color:#f92672">-</span>cbc<span style="color:#f92672">-</span>256
</span></span><span style="display:flex;"><span> integrity sha256
</span></span><span style="display:flex;"><span> group 19
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 profile PROFILE<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span> match identity remote address 2.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">2</span> 255.<span style="color:#a6e22e">255</span>.<span style="color:#a6e22e">255</span>.<span style="color:#a6e22e">255</span>
</span></span><span style="display:flex;"><span> authentication local pre<span style="color:#f92672">-</span>share
</span></span><span style="display:flex;"><span> authentication remote pre<span style="color:#f92672">-</span>share
</span></span><span style="display:flex;"><span> keyring local HQ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 policy POL<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span> proposal Prop<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ip access<span style="color:#f92672">-</span>list extended VPNACL<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span> permit ip host 10.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">2</span> host 10.<span style="color:#a6e22e">1</span>.<span style="color:#a6e22e">1</span>.<span style="color:#a6e22e">1</span>
</span></span><span style="display:flex;"><span> permit ip host 10.<span style="color:#a6e22e">1</span>.<span style="color:#a6e22e">1</span>.<span style="color:#a6e22e">1</span> host 10.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ipsec transform<span style="color:#f92672">-</span>set TS<span style="color:#f92672">-</span>HQ esp<span style="color:#f92672">-</span>aes 256 esp<span style="color:#f92672">-</span>sha256<span style="color:#f92672">-</span>hmac
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">!</span> Define Crypto map and Ipsec
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto map CMAP<span style="color:#f92672">-</span>HQ 10 ipsec<span style="color:#f92672">-</span>isakmp
</span></span><span style="display:flex;"><span> set peer 2.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">2</span>
</span></span><span style="display:flex;"><span> set security<span style="color:#f92672">-</span>association lifetime seconds 3600
</span></span><span style="display:flex;"><span> set transform<span style="color:#f92672">-</span>set TS<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span> set pfs 
</span></span><span style="display:flex;"><span> set ikev2<span style="color:#f92672">-</span>profile PROFILE<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span> match address VPNACL<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">GigabitEthernet0</span><span style="color:#f92672">/</span>0<span style="color:#f92672">/</span>0
</span></span><span style="display:flex;"><span> ip address 1.<span style="color:#a6e22e">1</span>.<span style="color:#a6e22e">1</span>.<span style="color:#a6e22e">1</span> 255.<span style="color:#a6e22e">255</span>.<span style="color:#a6e22e">255</span>.<span style="color:#a6e22e">224</span>
</span></span><span style="display:flex;"><span> negotiation auto
</span></span><span style="display:flex;"><span> crypto map CMAP<span style="color:#f92672">-</span>HQ
</span></span></code></pre></div>
        </div>
    </div>
    <a href="#" id="scrollToTopButton">
        <svg t="1686753152588" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
            p-id="3988" width="48" height="48">
            <path
                d="M518.5 360.3c-3.2-4.4-9.7-4.4-12.9 0l-178 246c-3.8 5.3 0 12.7 6.5 12.7H381c10.2 0 19.9-4.9 25.9-13.2L512 460.4l105.2 145.4c6 8.3 15.6 13.2 25.9 13.2H690c6.5 0 10.3-7.4 6.5-12.7l-178-246z"
                p-id="3989" fill="#363636"></path>
            <path
                d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64z m0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"
                p-id="3990" fill="#363636"></path>
        </svg>
    </a><hr style="border-top: 1px solid #EEEEEE;">
<div id="comment"></div>
<script>
    const getStoredTheme = () => localStorage.getItem("theme") === "dark" ? "dark" : "light";

    const setGiscusTheme = () => {
        const sendMessage = (message) => {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (iframe) {
                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');
            }
        }
        sendMessage({setConfig: {theme: getStoredTheme()}})
    }

    document.addEventListener("DOMContentLoaded", () => {
        const giscusAttributes = {
            "src": "https://giscus.app/client.js",
            "data-repo": "bufo333\/johnburns.io_public",
            "data-repo-id": "R_kgDOHYBJIg",
            "data-category": "Announcements",
            "data-category-id": "DIC_kwDOHYBJIs4Cokmt",
            "data-mapping": "og:title",
            "data-reactions-enabled": "1",
            "data-emit-metadata": "0",
            "data-input-position": "bottom",
            "data-theme": getStoredTheme(),
            "data-lang": "en",
            "data-loading": "lazy",
            "crossorigin": "anonymous",
        };

        
        const giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(
            ([key, value]) => giscusScript.setAttribute(key, value));
        document.getElementById("comment").appendChild(giscusScript);

        
        const themeToggle = document.querySelector(".theme-toggle");
        if (themeToggle) {
            themeToggle.addEventListener("click", setGiscusTheme);
        }
    });

</script>


<div class="pp-container">
        <section class="pre-and-post">
            <div class="has-text-left">
                
                <p>Previous post</p>
                <a href="https://johnburns.io/post/rename-accounts-in-freebsd/">rename-accounts-in-freebsd</a>
                
            </div>
            <div class="has-text-right">
                
                <p>Next post</p>
                <a href="https://johnburns.io/post/gnupg-cheat-sheet/">GnuPG Cheat Sheet</a>
                
            </div>
        </section>
    </div>

</div>

        </main><footer class="footer">
    <div class="content has-text-centered">
    <span>&copy; 2025 <a href="https://johnburns.io/">The Colour of My Thoughts</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" target="_blank">Hugo</a> &
    </span>
    </div>
  </footer></body>
</html>

