<!DOCTYPE html>
<html lang=""><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>beginner-network-templating</title>
    <meta name="description" content="The desk of my mind.">
    <meta name="author" content='John Burns'>

    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css" integrity="sha512-rt/SrQ4UNIaGfDyEXZtNcyWvQeOq0QLygHluFQcSjaGB04IxWhal71tKuzP6K8eYXYB6vJV4pHkXcmFGGQ1/0w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.3/css/academicons.min.css" integrity="sha512-vaoopdl+FJahyY2ddhsbDj8yDiRuyUYH/vIjF3z+cBg0sKc07NAQmUYli8volCGlW9OwlQyjVsr7Lh6qAManlw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/sass/researcher.min.css">
    
        <link rel="icon" type="image/ico" href="https://johnburns.io/favicon.ico">
    

    </head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha512-t2ALGTyUR6g1HJiHCmSTge2yGseGofdO88Q+zOWQx/N0ikecVw0YuyOet9xZDV8+Vx0Y0n1a3f3Qx3V9CcnsKA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js" integrity="sha512-EKW5YvKU3hpyyOcN6jQnAxO/L8gts+YdYV6Yymtl8pk9YlYFtqJgihORuRoBXK8/cOIlappdU6Ms8KdK6yBCgA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js" integrity="sha512-iWiuBS5nt6r60fCz26Nd0Zqe0nbk1ZTIQbl3Kv7kYsX+yKMUFHzjaH2+AnM6vp2Xs+gNmaBAVWJjSmuPw76Efg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "\\[", right: "\\]", display: true},
                {left: "$", right: "$", display: false},
                {left: "\\(", right: "\\)", display: false}
            ]
        });
    });
</script>

    <body><div class="container mt-5">
    <nav class="navbar navbar-expand-sm flex-column flex-sm-row text-nowrap p-0">
        <a class="navbar-brand mx-0 mr-sm-auto" href="https://johnburns.io/" title="The Colour of My Thoughts">
          
          The Colour of My Thoughts
        </a>
        <div class="navbar-nav flex-row flex-wrap justify-content-center">
            
                
                
                    <a class="nav-item nav-link" href="/about/" title="About">
                        About
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/resume.pdf" title="Resume">
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-file-earmark-person-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M2 2a2 2 0 0 1 2-2h5.293A1 1 0 0 1 10 .293L13.707 4a1 1 0 0 1 .293.707V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm7.5 1.5v-2l3 3h-2a1 1 0 0 1-1-1zM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0zm2 5.755S12 12 8 12s-5 1.755-5 1.755V14a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-.245z"/></svg> Resume
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/contact/" title="Contact">
                        Contact
                    </a>
                    
                
            
        </div>
    </nav>
</div>
<hr>
<div id="content">
<div class="container">
    <h2 id="develop-and-deploy-network-templates-before-automating">Develop and Deploy Network Templates Before Automating</h2>
<p>Date: 2022-05-26<br>
Subject: Network Templating<br>
Version 1.0</p>
<!--start-summary-->
<p>Automation is the number one topic in networking today. Automation allows a team to lean left, moving simple troubleshooting to the NOC, it allows the team to do more with less, and it allows for repeatable deployments. A good place to start is to think about many of the day to day work that gets done, how much of this work is simply applying the same changes over and over. These tasks are a great place to start with templating.</p>
<p>I think an obvious task to start for automation is VPN deployments. This is a task that involved touching at least 2 routers and possibly 4 routers if redundant VPN&rsquo;s are the standard for your company. This usually also involves configuring an IGP or BGP instance or both on each router, as well as modifying multiple Access lists. It is also a task where small inconsistencies can lead to hours of troubleshooting.</p>



<div class="goat svg-container ">
  
    <svg
      xmlns="http://www.w3.org/2000/svg"
      font-family="Menlo,Lucida Console,monospace"
      
        viewBox="0 0 336 217"
      >
      <g transform='translate(8,16)'>
<path d='M 0,16 L 112,16' fill='none' stroke='currentColor'></path>
<path d='M 160,16 L 280,16' fill='none' stroke='currentColor'></path>
<path d='M 16,48 L 88,48' fill='none' stroke='currentColor'></path>
<path d='M 176,48 L 264,48' fill='none' stroke='currentColor'></path>
<path d='M 96,80 L 104,80' fill='none' stroke='currentColor'></path>
<path d='M 120,80 L 152,80' fill='none' stroke='currentColor'></path>
<path d='M 168,80 L 176,80' fill='none' stroke='currentColor'></path>
<path d='M 16,96 L 88,96' fill='none' stroke='currentColor'></path>
<path d='M 176,96 L 264,96' fill='none' stroke='currentColor'></path>
<path d='M 16,128 L 88,128' fill='none' stroke='currentColor'></path>
<path d='M 176,128 L 264,128' fill='none' stroke='currentColor'></path>
<path d='M 96,160 L 104,160' fill='none' stroke='currentColor'></path>
<path d='M 120,160 L 152,160' fill='none' stroke='currentColor'></path>
<path d='M 168,160 L 176,160' fill='none' stroke='currentColor'></path>
<path d='M 24,176 L 80,176' fill='none' stroke='currentColor'></path>
<path d='M 184,176 L 264,176' fill='none' stroke='currentColor'></path>
<path d='M 8,192 L 112,192' fill='none' stroke='currentColor'></path>
<path d='M 160,192 L 280,192' fill='none' stroke='currentColor'></path>
<path d='M 0,32 L 0,192' fill='none' stroke='currentColor'></path>
<path d='M 16,64 L 16,80' fill='none' stroke='currentColor'></path>
<path d='M 16,144 L 16,176' fill='none' stroke='currentColor'></path>
<path d='M 48,104 L 48,120' fill='none' stroke='currentColor'></path>
<path d='M 88,64 L 88,80' fill='none' stroke='currentColor'></path>
<path d='M 88,144 L 88,176' fill='none' stroke='currentColor'></path>
<path d='M 112,32 L 112,176' fill='none' stroke='currentColor'></path>
<path d='M 160,32 L 160,176' fill='none' stroke='currentColor'></path>
<path d='M 176,64 L 176,80' fill='none' stroke='currentColor'></path>
<path d='M 176,144 L 176,176' fill='none' stroke='currentColor'></path>
<path d='M 216,104 L 216,120' fill='none' stroke='currentColor'></path>
<path d='M 264,64 L 264,80' fill='none' stroke='currentColor'></path>
<path d='M 264,144 L 264,160' fill='none' stroke='currentColor'></path>
<path d='M 280,32 L 280,176' fill='none' stroke='currentColor'></path>
<path d='M 0,24 L 0,32' fill='none' stroke='currentColor'></path>
<path d='M 16,56 L 16,64' fill='none' stroke='currentColor'></path>
<path d='M 16,80 L 16,88' fill='none' stroke='currentColor'></path>
<path d='M 16,136 L 16,144' fill='none' stroke='currentColor'></path>
<path d='M 16,176 L 16,184' fill='none' stroke='currentColor'></path>
<path d='M 48,104 L 48,112' fill='none' stroke='currentColor'></path>
<path d='M 88,56 L 88,64' fill='none' stroke='currentColor'></path>
<path d='M 88,80 L 88,88' fill='none' stroke='currentColor'></path>
<path d='M 88,136 L 88,144' fill='none' stroke='currentColor'></path>
<path d='M 88,176 L 88,184' fill='none' stroke='currentColor'></path>
<path d='M 112,24 L 112,32' fill='none' stroke='currentColor'></path>
<path d='M 112,176 L 112,184' fill='none' stroke='currentColor'></path>
<path d='M 160,24 L 160,32' fill='none' stroke='currentColor'></path>
<path d='M 160,176 L 160,184' fill='none' stroke='currentColor'></path>
<path d='M 176,56 L 176,64' fill='none' stroke='currentColor'></path>
<path d='M 176,80 L 176,88' fill='none' stroke='currentColor'></path>
<path d='M 176,136 L 176,144' fill='none' stroke='currentColor'></path>
<path d='M 176,176 L 176,184' fill='none' stroke='currentColor'></path>
<path d='M 216,104 L 216,112' fill='none' stroke='currentColor'></path>
<path d='M 264,56 L 264,64' fill='none' stroke='currentColor'></path>
<path d='M 264,80 L 264,88' fill='none' stroke='currentColor'></path>
<path d='M 264,136 L 264,144' fill='none' stroke='currentColor'></path>
<path d='M 264,160 L 264,168' fill='none' stroke='currentColor'></path>
<path d='M 280,24 L 280,32' fill='none' stroke='currentColor'></path>
<path d='M 280,176 L 280,184' fill='none' stroke='currentColor'></path>
<text text-anchor='middle' x='24' y='68' fill='currentColor' style='font-size:1em'>H</text>
<text text-anchor='middle' x='24' y='148' fill='currentColor' style='font-size:1em'>H</text>
<text text-anchor='middle' x='32' y='68' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='32' y='148' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='40' y='68' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='40' y='148' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='48' y='36' fill='currentColor' style='font-size:1em'>H</text>
<text text-anchor='middle' x='48' y='68' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='48' y='84' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='48' y='148' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='48' y='164' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='56' y='36' fill='currentColor' style='font-size:1em'>Q</text>
<text text-anchor='middle' x='56' y='84' fill='currentColor' style='font-size:1em'>1</text>
<text text-anchor='middle' x='56' y='164' fill='currentColor' style='font-size:1em'>2</text>
<text text-anchor='middle' x='64' y='68' fill='currentColor' style='font-size:1em'>E</text>
<text text-anchor='middle' x='64' y='148' fill='currentColor' style='font-size:1em'>E</text>
<text text-anchor='middle' x='72' y='68' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='72' y='148' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='80' y='68' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='80' y='148' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='96' y='4' fill='currentColor' style='font-size:1em'>T</text>
<text text-anchor='middle' x='104' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='112' y='4' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='120' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='128' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='136' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='144' y='4' fill='currentColor' style='font-size:1em'>g</text>
<text text-anchor='middle' x='152' y='4' fill='currentColor' style='font-size:1em'>y</text>
<text text-anchor='middle' x='176' y='36' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='184' y='36' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='192' y='36' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='192' y='68' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='200' y='36' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='200' y='68' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='200' y='148' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='208' y='36' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='208' y='68' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='208' y='84' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='208' y='148' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='216' y='36' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='216' y='68' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='216' y='84' fill='currentColor' style='font-size:1em'>1</text>
<text text-anchor='middle' x='216' y='148' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='216' y='164' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='224' y='68' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='224' y='148' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='224' y='164' fill='currentColor' style='font-size:1em'>2</text>
<text text-anchor='middle' x='232' y='36' fill='currentColor' style='font-size:1em'>S</text>
<text text-anchor='middle' x='232' y='68' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='232' y='148' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='240' y='36' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='240' y='148' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='248' y='36' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='256' y='36' fill='currentColor' style='font-size:1em'>e</text>
</g>

    </svg>
  
</div>
<h5 id="whats-needed">What&rsquo;s Needed</h5>
<ul>
<li>Python 3.x
<ul>
<li>Jinja support</li>
<li>Yaml  support</li>
</ul>
</li>
<li>Yaml Answer File</li>
<li>Jinja Template for each router</li>
<li>python script to render</li>
</ul>
<ol>
<li>First we need to create a template for each router. I am only providing a single template here instead of four. Although this is a working correct template, configuring VPN&rsquo;s is beyond the scope of this tutorial. Anyone with a few years of experience should be able to build the missing files in a lab based on whats provided.</li>
</ol>
<ul>
<li>cisco.j2</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">!</span>Configure GRE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#960050;background-color:#1e0010">{{ </span><span style="color:#a6e22e">loopback_interface</span> <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> ip address <span style="color:#f92672">{{</span> loopback_address <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#960050;background-color:#1e0010">{{ </span><span style="color:#a6e22e">tunnel_interface</span><span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>  no shutdown
</span></span><span style="display:flex;"><span>  ip address 10<span style="color:#f92672">.</span><span style="color:#a6e22e">10</span><span style="color:#f92672">.</span><span style="color:#a6e22e">100</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span> 255<span style="color:#f92672">.</span><span style="color:#a6e22e">255</span><span style="color:#f92672">.</span><span style="color:#a6e22e">255</span><span style="color:#f92672">.</span><span style="color:#a6e22e">0</span>
</span></span><span style="display:flex;"><span>  tunnel source <span style="color:#f92672">{{</span>loopback_interface <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>  tunnel destination <span style="color:#f92672">{{</span> tunnel_destination <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>  tunnel path<span style="color:#f92672">-</span>mtu<span style="color:#f92672">-</span>discovery
</span></span><span style="display:flex;"><span>  tunnel protection ipsec profile ikev2_TP
</span></span><span style="display:flex;"><span>  exit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">!</span>Configure Ike Policy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 keyring <span style="color:#f92672">{{</span> ike_keyring_name <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> peer <span style="color:#f92672">{{</span> ike_keyring_peer <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>  address <span style="color:#f92672">{{</span> ike_keyring_address <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>  pre<span style="color:#f92672">-</span>shared<span style="color:#f92672">-</span>key <span style="color:#f92672">{{</span> ike_keyring_preshared_key <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 proposal <span style="color:#f92672">{{</span>proposal_name <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> encryption <span style="color:#f92672">{{</span> proposal_encryption <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> integrity <span style="color:#f92672">{{</span> proposal_integrity <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> group <span style="color:#f92672">{{</span> proposal_group <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 profile <span style="color:#f92672">{{</span> profile_name <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> match identity remote address <span style="color:#f92672">{{</span> profile_remote_address <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> authentication local <span style="color:#f92672">{{</span> profile_authentication_local <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> authentication remote <span style="color:#f92672">{{</span> profile_authentication_remote <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> keyring local <span style="color:#f92672">{{</span> profile_keyring_local <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 policy <span style="color:#f92672">{{</span> crypto_policy_name <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> proposal <span style="color:#f92672">{{</span> crypto_policy_proposal <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ip access<span style="color:#f92672">-</span>list extended <span style="color:#f92672">{{</span> crypto_match_acl_name <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> permit ip host <span style="color:#f92672">{{</span> crypto_match_acl_local <span style="color:#f92672">}}</span> host <span style="color:#f92672">{{</span> crypto_match_acl_remote <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> permit ip host <span style="color:#f92672">{{</span>crypto_match_acl_remote <span style="color:#f92672">}}</span> host <span style="color:#f92672">{{</span> crypto_match_acl_local <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ipsec transform<span style="color:#f92672">-</span>set <span style="color:#f92672">{{</span> transformset_data <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">!</span> Define Crypto map and Ipsec
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto map <span style="color:#f92672">{{</span> cryptomap_name <span style="color:#f92672">}}</span> ipsec<span style="color:#f92672">-</span>isakmp
</span></span><span style="display:flex;"><span> set peer <span style="color:#f92672">{{</span> cryptomap_peer <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> set security<span style="color:#f92672">-</span>association lifetime seconds 3600
</span></span><span style="display:flex;"><span> set transform<span style="color:#f92672">-</span>set <span style="color:#f92672">{{</span> cryptomap_tset <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> set pfs <span style="color:#f92672">{{</span> cryptomap_group <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> set ikev2<span style="color:#f92672">-</span>profile <span style="color:#f92672">{{</span> cryptomap_profile <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> match address <span style="color:#f92672">{{</span> cryptomap_match <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#960050;background-color:#1e0010">{{ </span><span style="color:#a6e22e">interface_name</span> <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span> ip address 1<span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span> 255<span style="color:#f92672">.</span><span style="color:#a6e22e">255</span><span style="color:#f92672">.</span><span style="color:#a6e22e">255</span><span style="color:#f92672">.</span><span style="color:#a6e22e">224</span>
</span></span><span style="display:flex;"><span> negotiation auto
</span></span><span style="display:flex;"><span> <span style="color:#f92672">{{</span> interface_crypto <span style="color:#f92672">}}</span>
</span></span></code></pre></div><ul>
<li>Yaml Answer file</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">loopback_interface</span>: <span style="color:#ae81ff">Loopback0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">loopback_address</span>: <span style="color:#e6db74">&#34;10.1.1.1 255.255.255.0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">tunnel_interface</span>: <span style="color:#ae81ff">Tunnel100</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">tunnel_destination</span>: <span style="color:#ae81ff">10.2.2.2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">ike_keyring_name</span>: <span style="color:#ae81ff">HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">ike_keyring_peer</span>: <span style="color:#ae81ff">HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">ike_keyring_address</span>: <span style="color:#ae81ff">2.2.2.2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">ike_keyring_preshared_key</span>: <span style="color:#ae81ff">cisco1234</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">proposal_name</span>: <span style="color:#ae81ff">Prop-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">proposal_encryption</span>: <span style="color:#ae81ff">aes-cbc-256</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">proposal_integrity</span>: <span style="color:#ae81ff">sha256</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">proposal_group</span>: <span style="color:#ae81ff">19</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">profile_name</span>: <span style="color:#ae81ff">PROFILE-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">profile_remote_address</span>: <span style="color:#e6db74">&#34;2.2.2.2 255.255.255.255&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">profile_authentication_local</span>: <span style="color:#ae81ff">pre-share</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">profile_authentication_remote</span>: <span style="color:#ae81ff">pre-share</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">profile_keyring_local</span>: <span style="color:#ae81ff">HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">crypto_policy_name</span>: <span style="color:#ae81ff">POL-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">crypto_policy_proposal</span>: <span style="color:#ae81ff">Prop-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">crypto_match_acl_name</span>: <span style="color:#ae81ff">VPNACL-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">crypto_match_acl_local</span>: <span style="color:#ae81ff">10.2.2.2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">crypto_match_acl_remote</span>: <span style="color:#ae81ff">10.1.1.1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">transformset_data</span>: <span style="color:#e6db74">&#34;TS-HQ esp-aes 256 esp-sha256-hmac&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cryptomap_name</span>: <span style="color:#e6db74">&#34;CMAP-HQ 10&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cryptomap_peer</span>: <span style="color:#ae81ff">2.2.2.2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cryptomap_tset</span>: <span style="color:#ae81ff">TS-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cryptomap_pfs</span>: <span style="color:#ae81ff">group19</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cryptomap_profile</span>: <span style="color:#ae81ff">PROFILE-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cryptomap_match</span>: <span style="color:#ae81ff">VPNACL-HQ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">interface_name</span>: <span style="color:#ae81ff">GigabitEthernet0/0/0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">interface_crypto</span>: <span style="color:#e6db74">&#34;crypto map CMAP-HQ&#34;</span>
</span></span></code></pre></div><ul>
<li>script.py</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#Imports </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> yaml
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> jinja2 <span style="color:#f92672">import</span> Environment, FileSystemLoader
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Load yaml template into memory</span>
</span></span><span style="display:flex;"><span>config <span style="color:#f92672">=</span> yaml<span style="color:#f92672">.</span>load(open(<span style="color:#e6db74">&#39;./answer.yaml&#39;</span>,<span style="color:#e6db74">&#39;r&#39;</span>), Loader<span style="color:#f92672">=</span>yaml<span style="color:#f92672">.</span>FullLoader)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Load jinja template into memory</span>
</span></span><span style="display:flex;"><span>env <span style="color:#f92672">=</span> Environment(loader <span style="color:#f92672">=</span> FileSystemLoader(<span style="color:#e6db74">&#39;./&#39;</span>), trim_blocks<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, lstrip_blocks<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>template <span style="color:#f92672">=</span> env<span style="color:#f92672">.</span>get_template(<span style="color:#e6db74">&#39;cisco.j2&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Render template to file</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;cisco-out.txt&#34;</span>,<span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>  f<span style="color:#f92672">.</span>write(template<span style="color:#f92672">.</span>render(config))
</span></span></code></pre></div><ul>
<li>Output</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">!</span>Configure GRE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Loopback0</span>
</span></span><span style="display:flex;"><span> ip address 10<span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span> 255<span style="color:#f92672">.</span><span style="color:#a6e22e">255</span><span style="color:#f92672">.</span><span style="color:#a6e22e">255</span><span style="color:#f92672">.</span><span style="color:#a6e22e">0</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Tunnel100</span>
</span></span><span style="display:flex;"><span>  no shutdown
</span></span><span style="display:flex;"><span>  ip address 10<span style="color:#f92672">.</span><span style="color:#a6e22e">10</span><span style="color:#f92672">.</span><span style="color:#a6e22e">100</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span> 255<span style="color:#f92672">.</span><span style="color:#a6e22e">255</span><span style="color:#f92672">.</span><span style="color:#a6e22e">255</span><span style="color:#f92672">.</span><span style="color:#a6e22e">0</span>
</span></span><span style="display:flex;"><span>  tunnel source Loopback0
</span></span><span style="display:flex;"><span>  tunnel destination 10<span style="color:#f92672">.</span><span style="color:#a6e22e">2</span><span style="color:#f92672">.</span><span style="color:#a6e22e">2</span><span style="color:#f92672">.</span><span style="color:#a6e22e">2</span>
</span></span><span style="display:flex;"><span>  tunnel path<span style="color:#f92672">-</span>mtu<span style="color:#f92672">-</span>discovery
</span></span><span style="display:flex;"><span>  tunnel protection ipsec profile ikev2_TP
</span></span><span style="display:flex;"><span>  exit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">!</span>Configure Ike Policy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 keyring HQ
</span></span><span style="display:flex;"><span> peer HQ
</span></span><span style="display:flex;"><span>  address 2<span style="color:#f92672">.</span><span style="color:#a6e22e">2</span><span style="color:#f92672">.</span><span style="color:#a6e22e">2</span><span style="color:#f92672">.</span><span style="color:#a6e22e">2</span>
</span></span><span style="display:flex;"><span>  pre<span style="color:#f92672">-</span>shared<span style="color:#f92672">-</span>key cisco1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 proposal Prop<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span> encryption aes<span style="color:#f92672">-</span>cbc<span style="color:#f92672">-</span>256
</span></span><span style="display:flex;"><span> integrity sha256
</span></span><span style="display:flex;"><span> group 19
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 profile PROFILE<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span> match identity remote address 2<span style="color:#f92672">.</span><span style="color:#a6e22e">2</span><span style="color:#f92672">.</span><span style="color:#a6e22e">2</span><span style="color:#f92672">.</span><span style="color:#a6e22e">2</span> 255<span style="color:#f92672">.</span><span style="color:#a6e22e">255</span><span style="color:#f92672">.</span><span style="color:#a6e22e">255</span><span style="color:#f92672">.</span><span style="color:#a6e22e">255</span>
</span></span><span style="display:flex;"><span> authentication local pre<span style="color:#f92672">-</span>share
</span></span><span style="display:flex;"><span> authentication remote pre<span style="color:#f92672">-</span>share
</span></span><span style="display:flex;"><span> keyring local HQ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ikev2 policy POL<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span> proposal Prop<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ip access<span style="color:#f92672">-</span>list extended VPNACL<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span> permit ip host 10<span style="color:#f92672">.</span><span style="color:#a6e22e">2</span><span style="color:#f92672">.</span><span style="color:#a6e22e">2</span><span style="color:#f92672">.</span><span style="color:#a6e22e">2</span> host 10<span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span>
</span></span><span style="display:flex;"><span> permit ip host 10<span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span> host 10<span style="color:#f92672">.</span><span style="color:#a6e22e">2</span><span style="color:#f92672">.</span><span style="color:#a6e22e">2</span><span style="color:#f92672">.</span><span style="color:#a6e22e">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto ipsec transform<span style="color:#f92672">-</span>set TS<span style="color:#f92672">-</span>HQ esp<span style="color:#f92672">-</span>aes 256 esp<span style="color:#f92672">-</span>sha256<span style="color:#f92672">-</span>hmac
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">!</span> Define Crypto map and Ipsec
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crypto map CMAP<span style="color:#f92672">-</span>HQ 10 ipsec<span style="color:#f92672">-</span>isakmp
</span></span><span style="display:flex;"><span> set peer 2<span style="color:#f92672">.</span><span style="color:#a6e22e">2</span><span style="color:#f92672">.</span><span style="color:#a6e22e">2</span><span style="color:#f92672">.</span><span style="color:#a6e22e">2</span>
</span></span><span style="display:flex;"><span> set security<span style="color:#f92672">-</span>association lifetime seconds 3600
</span></span><span style="display:flex;"><span> set transform<span style="color:#f92672">-</span>set TS<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span> set pfs 
</span></span><span style="display:flex;"><span> set ikev2<span style="color:#f92672">-</span>profile PROFILE<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span> match address VPNACL<span style="color:#f92672">-</span>HQ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">GigabitEthernet0</span><span style="color:#f92672">/</span>0<span style="color:#f92672">/</span>0
</span></span><span style="display:flex;"><span> ip address 1<span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">1</span> 255<span style="color:#f92672">.</span><span style="color:#a6e22e">255</span><span style="color:#f92672">.</span><span style="color:#a6e22e">255</span><span style="color:#f92672">.</span><span style="color:#a6e22e">224</span>
</span></span><span style="display:flex;"><span> negotiation auto
</span></span><span style="display:flex;"><span> crypto map CMAP<span style="color:#f92672">-</span>HQ
</span></span></code></pre></div>
</div>

        </div><div id="footer" class="mb-5">
    <hr>
    
    <div class="container text-center">
        
            <a href="https://twitter.com/" class="fab fa-twitter fa-1x" title="Twitter"></a>
        
            <a href="mailto:john@techinvasion.net" class="fas fa-envelope fa-1x" title="E-mail"></a>
        
    </div>
    
    
        <div class="container text-center">
            <a href="https://github.com/bufo333/" title="By John Burns" ><small>By John Burns</small></a>
        </div>
    
</div>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1329465157209102"
    crossorigin="anonymous"></script>
        
    </body>
</html>
