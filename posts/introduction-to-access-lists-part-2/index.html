<!DOCTYPE html>
<html lang=""><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>introduction-to-access-lists-part-2</title>
    <meta name="description" content="The desk of my mind.">
    <meta name="author" content='John Burns'>

    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous">

    
    <link rel="stylesheet" href="/sass/researcher.min.css">

    
        <link rel="icon" type="image/ico" href="https://johnburns.io/favicon.ico">
    

    
        
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LQNL2E5MEL"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-LQNL2E5MEL', { 'anonymize_ip': false });
}
</script>

    
</head>

    <body><div class="container mt-5">
    <nav class="navbar navbar-expand-sm flex-column flex-sm-row text-nowrap p-0">
        <a class="navbar-brand mx-0 mr-sm-auto" href="https://johnburns.io/" title="The Colour of My Thoughts">
          
          The Colour of My Thoughts
        </a>
        <div class="navbar-nav flex-row flex-wrap justify-content-center">
            
                
                
                    <a class="nav-item nav-link" href="/about/" title="About">
                        About
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/resume.pdf" title="Resume">
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-file-earmark-person-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M2 2a2 2 0 0 1 2-2h5.293A1 1 0 0 1 10 .293L13.707 4a1 1 0 0 1 .293.707V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm7.5 1.5v-2l3 3h-2a1 1 0 0 1-1-1zM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0zm2 5.755S12 12 8 12s-5 1.755-5 1.755V14a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-.245z"/></svg> Resume
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/contact/" title="Contact">
                        Contact
                    </a>
                    
                
            
        </div>
    </nav>
</div>
<hr>
<div id="content">
<div class="container">
    <h2 id="introduction-to-access-lists-part-2">Introduction to access-lists part 2</h2>
<p>In the second installment of our guide to access-lists we are going to talk a little about named access-lists, how they work, what the benefits are, and how using them allows us to create reflexive access-lists. Named access-lists are exactly what they sound like, they are an extended access-list that has a name instead of a number. One of the nice features of named access-lists is that each line of the access-list has a number. this way you can delete just one line in an access-list without removing the whole access-list. You can create a named access list by using the following command.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">#</span><span class="nx">ip</span> <span class="nx">access</span><span class="o">-</span><span class="nx">list</span> <span class="nx">extended</span>  <span class="p">(</span><span class="nx">name</span> <span class="nx">goes</span> <span class="nx">here</span><span class="p">)</span>
</span></span></code></pre></div><p>The neat thing about named access-lists is that when you do a show access-list command you see number s next to the lines in the acl. This allows you to add or remove lines without deleting the whole access-list.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">test</span><span class="err">#</span><span class="nx">sh</span> <span class="nx">ip</span> <span class="nx">access</span><span class="o">-</span><span class="nx">list</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">extended</span> <span class="nx">ip</span> <span class="nx">access</span><span class="o">-</span><span class="nx">list</span> <span class="nx">example</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="mi">10</span> <span class="nx">permit</span> <span class="nx">ip</span> <span class="nx">any</span> <span class="nx">any</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="mi">20</span> <span class="nx">deny</span> <span class="nx">tcp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="nx">eq</span> <span class="mi">80</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="mi">30</span> <span class="nx">permit</span> <span class="nx">udp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="nx">eq</span> <span class="mi">53</span>  
</span></span></code></pre></div><p>Reflexive access-lists allow you to filter connections based on session. Reflexive ACL&rsquo;s are part of the ip plus feature set and was the first attempt to create a statefull inspection firewall on routers. Before the invention of reflexive access-lists the only way we had to allow stateful return traffic from the internet was by using the establish keyword. The problem with the established keyword is that the router only checks for the ack bit on the packets. The ack bit is set on packets once the 3 way handshake has been completed. the problem with this is that it does not do anything for udp packets since those connections are stateless, and it is very easy for hackers to set the ack bit. To get around this problem Cisco invented the reflexive access-list.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">permit</span> <span class="nx">tcp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="nx">eq</span> <span class="mi">80</span> <span class="nx">established</span>
</span></span></code></pre></div><p>Reflexive access-lists are very easy. I have added the code for the access-list below. Basically reflexive access-list are made up of two parts. The first part, is the access-list that filters outbound traffic. This access-list is made up of statements that allow outbound traffic. the key part here is the reflect statement. What this means is that you want to reflect that packet in another access list.</p>
<p>In my example below I reflected the statements in an access-list called dynamic. Now I created two access-lists. I created an inbound access-list to allow static inbound traffic to my webserver. I created an outbound access-list to allow traffic from my lan to the internet. I told my inbound access-list to check the reflexive entries before blocking traffic using the evaluate command. This is all there is too it. With these simple commands you can commands you can configure a statefull firewall to protect your network from harm. As good as this is though it isn&rsquo;t perfect. It doesn&rsquo;t work for application which use dynamic port numbers for return traffic. To solve this problem cisco added layer 4 inspection and refined reflexive access-lists in what they call Content Based Access Control or CBAC. However CBAC is part of the ios fw feature set and is a topic for another time.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">FastEthernet0</span><span class="o">/</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">description</span> <span class="nx">WAN</span> <span class="nx">Interface</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">ip</span> <span class="nx">address</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">0.1</span> <span class="mf">255.255</span><span class="p">.</span><span class="mf">255.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">ip</span> <span class="nx">access</span><span class="o">-</span><span class="nx">group</span> <span class="nx">internet_in</span> <span class="k">in</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">ip</span> <span class="nx">access</span><span class="o">-</span><span class="nx">group</span> <span class="nx">lan_out</span> <span class="nx">out</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">duplex</span> <span class="nx">auto</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">speed</span> <span class="nx">auto</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">ip</span> <span class="nx">access</span><span class="o">-</span><span class="nx">list</span> <span class="nx">extended</span> <span class="nx">internet_in</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">remark</span> <span class="nx">Internet</span><span class="o">----&gt;</span><span class="nx">lan</span> <span class="nx">traffic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">permit</span> <span class="nx">tcp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="nx">eq</span> <span class="mi">80</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">permit</span> <span class="nx">tcp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="nx">eq</span> <span class="mi">443</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">evaluate</span> <span class="nx">dynamic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">ip</span> <span class="nx">access</span><span class="o">-</span><span class="nx">list</span> <span class="nx">extended</span> <span class="nx">lan_out</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">remark</span> <span class="nx">inside</span><span class="o">-----&gt;</span><span class="nx">internet</span> <span class="nx">traffic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">permit</span> <span class="nx">tcp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="nx">eq</span> <span class="nx">www</span> <span class="nx">reflect</span> <span class="nx">dynamic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">permit</span> <span class="nx">tcp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="nx">eq</span> <span class="mi">443</span> <span class="nx">reflect</span> <span class="nx">dynamic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">permit</span> <span class="nx">tcp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="nx">eq</span> <span class="mi">22</span> <span class="nx">reflect</span> <span class="nx">dynamic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">permit</span> <span class="nx">tcp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="nx">eq</span> <span class="nx">ftp</span> <span class="nx">reflect</span> <span class="nx">dynamic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">permit</span> <span class="nx">tcp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="nx">eq</span> <span class="nx">telnet</span> <span class="nx">reflect</span> <span class="nx">dynamic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">permit</span> <span class="nx">tcp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="nx">eq</span> <span class="nx">pop3</span> <span class="nx">reflect</span> <span class="nx">dynamic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">permit</span> <span class="nx">tcp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="nx">eq</span> <span class="nx">nntp</span> <span class="nx">reflect</span> <span class="nx">dynamic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="nx">permit</span> <span class="nx">tcp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="nx">eq</span> <span class="nx">smtp</span> <span class="nx">reflect</span> <span class="nx">dynamic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">!</span>
</span></span></code></pre></div>
</div>

        </div><div id="footer" class="mb-5">
    <hr>
    
    <div class="container text-center">
        
            <a href="https://twitter.com/" class="fab fa-twitter fa-1x" title="Twitter"></a>
        
            <a href="mailto:john@techinvasion.net" class="fas fa-envelope fa-1x" title="E-mail"></a>
        
    </div>
    
    
        <div class="container text-center">
            <a href="https://github.com/bufo333/" title="By John Burns"><small>By John Burns</small></a>
        </div>
    
</div>
</body>
</html>
